!function(a,b){"use strict";var c;c="object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("angular"),require("moment")):"function"==typeof define&&define.amd?define(["angular","moment"],b):b(a.angular,a.moment)}(this,function(a,b){var c=a.module("datePicker",[]);c.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),c.filter("mFormat",function(){return function(a,c,d){return b.isMoment(a)?d?b.tz(a,d).format(c):a.format(c):b(a).format(c)}}),c.directive("datePicker",["datePickerConfig","datePickerUtils",function(c,d){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",customData:"="},link:function(e,f,g,h){function i(){e.views=c.views.concat(),e.view=g.view||c.view,e.views=e.views.slice(e.views.indexOf(g.maxView||"year"),e.views.indexOf(g.minView||"minutes")+1),1!==e.views.length&&-1!==e.views.indexOf(e.view)||(e.view=e.views[0])}function j(a){return d.getDate(e,g,a)}function k(a,b){a&&(e.model=a,h&&h.$setViewValue(a)),e.$emit("setDate",e.model,e.view,b||!1),e.callbackOnSetDate&&e.callbackOnSetDate(g.datePicker,e.date)}function l(){var a=e.view;d.setParams(t),e.model&&!s&&(e.date=u(e.model),s=!1);var b=e.date;switch(a){case"year":e.years=d.getVisibleYears(b);break;case"month":e.months=d.getVisibleMonths(b);break;case"date":e.weekdays=e.weekdays||d.getDaysOfWeek(),e.weeks=d.getVisibleWeeks(b);break;case"hours":e.hours=d.getVisibleHours(b);break;case"minutes":e.minutes=d.getVisibleMinutes(b,w)}n()}function m(){return"date"!==e.view?e.view:e.date?e.date.month():null}function n(){var a,f,h=e.view,i=e.date,j=[],k="";if(d.setParams(t),"date"===h){var l,m=e.weeks;e.isRangeStart="start"==g.ngModel,e.isRangeEnd="end"==g.ngModel;var n=e.isRangeStart||e.isRangeEnd,p=e.isRangeEnd;if(n&&m.length<6){var q=b(m[m.length-1][0]);q.add(7,"d"),m.push(d.getDaysOfWeek(q))}for(a=0;a<m.length;a++)for(l=m[a],j.push([]),f=0;f<l.length;f++){var s=!1,u=!1;k="",d.isSameDay(i,l[f])&&(k+=" is-selected",e.isRangeStart?(p=!0,s=!0):e.isRangeEnd&&(p=!1,u=!0)),l[f].month()===i.month()&&o(l[f])?n&&p&&(k+=" is-selected",(f>0&&!o(l[f-1])||0===f&&(0===a||!o(_.last(m[a-1]))))&&(s=!0),(f<l.length-1&&!o(l[f+1])||f===l.length-1&&(a===m.length-1||!o(m[a+1][0])))&&(u=!0)):k+=" is-disabled",y&&d.isSameDay(i,y)&&(s=!0),z&&d.isSameDay(i,z)&&(u=!0),n&&s^u&&(s&&(k+=" is-selected-first"),u&&(k+=" is-selected-last")),e.customData&&e.customData.isRangeStart&&(k+=" is-selected-first"),j[a].push(k)}}else{var v=c.viewConfig[h],w=e[v[0]],x=v[1];for(a=0;a<w.length;a++)k="",d[x](i,w[a])&&(k+=" is-selected"),r(w[a],h)&&(k+=" is-now"),o(w[a])||(k+=" is-disabled"),j.push(k)}e.classes=j}function o(a){var b=!0;return y&&y.isAfter(a)&&(b=p(y,a)),z&&z.isBefore(a)&&(b&=p(z,a)),b}function p(a,b){return!!a.isSame(b,c.momentNames[e.view])}function q(a){return y&&y.isAfter(a)?(e.$emit("dateClip",a),y):z&&z.isBefore(a)?(e.$emit("dateClip",a),z):a}function r(a,b){var c=!0;switch(b){case"minutes":c&=~~(B.minutes()/w)===~~(a.minutes()/w);case"hours":c&=B.hours()===a.hours();case"date":c&=B.date()===a.date();case"month":c&=B.month()===a.month();case"year":c&=B.year()===a.year()}return c}d.setParams(g.timezone);var s=!1,t=e.tz=g.timezone,u=d.createMoment,v=d.eventIsForPicker,w=parseInt(g.step||c.step,10),x=!!g.partial,y=j("minDate"),z=j("maxDate"),A=f[0].id,B=e.now=u(),C=e.date=u(e.model||B),D="true"===g.autoClose;e.model||C.minute(Math.ceil(C.minute()/w)*w).second(0),e.template=g.template||c.template,e.watchDirectChanges=void 0!==g.watchDirectChanges,e.callbackOnSetDate=g.dateChange?d.findFunction(e,g.dateChange):void 0,i(),e.setView=function(a){-1!==e.views.indexOf(a)&&(e.view=a)},e.selectDate=function(a){if(g.disabled)return!1;if(p(e.date,a)&&(a=e.date),a=q(a),!a)return!1;e.date=a;var b=e.views[e.views.indexOf(e.view)+1];(!b||x||e.model)&&k(a),b?e.setView(b):D?(f.addClass("hidden"),e.$emit("hidePicker")):n()},e.$watch(m,l),e.watchDirectChanges&&e.$watch("model",function(){s=!1,l()}),e.next=function(a){var c=b(e.date);switch(a=a||1,e.view){case"year":case"month":c.year(c.year()+a);break;case"date":c.month(c.month()+a);break;case"hours":case"minutes":c.hours(c.hours()+a)}c=q(c),c&&(e.date=c,k(c,!0),s=!0,l())},e.prev=function(a){return e.next(-a||-1)},A&&e.$on("pickerUpdate",function(b,c,d){if(v(c,A)){var e=!1,f=!1;a.isDefined(d.minDate)&&(y=d.minDate?d.minDate:!1,f=!0),a.isDefined(d.maxDate)&&(z=d.maxDate?d.maxDate:!1,f=!0),a.isDefined(d.minView)&&(g.minView=d.minView,e=!0),a.isDefined(d.maxView)&&(g.maxView=d.maxView,e=!0),g.view=d.view||g.view,e&&i(),f&&l()}})}}}]),a.module("datePicker").factory("datePickerUtils",function(){var c,d=function(a,d,e,f,g){var h=Date.UTC(0|a,0|d,0|e,0|f,0|g);return c?b.tz(h,c):b(h)};return{getVisibleMinutes:function(a,b){var c,e,f=a.year(),g=a.month(),h=a.date(),i=a.hours(),j=a.utcOffset()/60,k=[];for(e=0;60>e;e+=b)c=d(f,g,h,i-j,e),k.push(c);return k},getVisibleWeeks:function(a){a=b(a);var c=a.year(),d=a.month();a.date(1);var e=a.day();0===e?a.date(-6):a.date(1-e);for(var f=[];f.length<6&&!(a.year()===c&&a.month()>d);)f.push(this.getDaysOfWeek(a)),a.add(7,"d");return f},getVisibleYears:function(a){var c=b(a),e=c.year();c.year(e-e%10),e=c.year();for(var f,g,h=c.utcOffset()/60,i=[],j=0;12>j;j++)f=d(e,0,1,0-h),g=f.utcOffset()/60,g!==h&&(f=d(e,0,1,0-g),h=g),i.push(f),e++;return i},getDaysOfWeek:function(a){a=a?a:c?b.tz(c).day(0):b().day(0);for(var e,f,g=a.year(),h=a.month(),i=a.date(),j=[],k=a.utcOffset()/60,l=0;7>l;l++)e=d(g,h,i,0-k,0,!1),f=e.utcOffset()/60,f!==k&&(e=d(g,h,i,0-f,0,!1)),j.push(e),i++;return j},getVisibleMonths:function(a){for(var b,c,e=a.year(),f=a.utcOffset()/60,g=[],h=0;12>h;h++)b=d(e,h,1,0-f,0,!1),c=b.utcOffset()/60,c!==f&&(b=d(e,h,1,0-c,0,!1)),g.push(b);return g},getVisibleHours:function(a){var b,c,e,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60;for(b=0;24>b;b++)c=d(f,g,h,b-j,0,!1),e=c.utcOffset()/60,e!==j&&(c=d(f,g,h,b-e,0,!1)),i.push(c);return i},isAfter:function(a,b){return a&&a.unix()>=b.unix()},isBefore:function(a,b){return a.unix()<=b.unix()},isSameYear:function(a,b){return a&&a.year()===b.year()},isSameMonth:function(a,b){return this.isSameYear(a,b)&&a.month()===b.month()},isSameDay:function(a,b){return this.isSameMonth(a,b)&&a.date()===b.date()},isSameHour:function(a,b){return this.isSameDay(a,b)&&a.hours()===b.hours()},isSameMinutes:function(a,b){return this.isSameHour(a,b)&&a.minutes()===b.minutes()},setParams:function(a){c=a},findFunction:function(b,c){var d=b;do if(d=d.$parent,a.isFunction(d[c]))return d[c];while(d.$parent);return!1},findParam:function(a,b){var c=a;do if(c=c.$parent,c[b])return c[b];while(c.$parent);return!1},createMoment:function(a){return c?b.tz(a,c):b.isMoment(a)?b.unix(a.unix()):b(a)},getDate:function(a,b,c){var d=!1;return b[c]&&(d=this.createMoment(b[c]),d.isValid()||(d=this.findParam(a,b[c]),d&&(d=this.createMoment(d)))),d},eventIsForPicker:function(b,c){return a.isArray(b)&&b.indexOf(c)>-1||b===c}}});var c=a.module("datePicker");c.directive("dateRange",["$compile","$templateCache","datePickerUtils","dateTimeConfig",function(c,d,e,f){function g(c,d,e,g,h){return f.template(a.extend(c,{ngModel:e,minDate:g&&b.isMoment(g)?g.format():!1,maxDate:h&&b.isMoment(h)?h.format():!1}),d)}function h(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"=",customData:"="},link:function(f,i,j){function k(a){f.$broadcast("pickerUpdate",o[0],{maxDate:a})}function l(a){f.$broadcast("pickerUpdate",o[1],{minDate:a})}var m=null,n=i[0].id,o=[h(),h()],p=e.createMoment,q=e.eventIsForPicker;f.dateChange=function(a,b){m&&m(a,b)},n&&f.$on("pickerUpdate",function(a,b,c){q(b,n)&&f.$broadcast("pickerUpdate",o,c)}),f.$on("dateClip",function(a,c){f.end=b(c),f.start=b(c),k(f.end),l(f.start)}),e.setParams(j.timezone),f.start=p(f.start),f.end=p(f.end),f.$watchGroup(["start","end"],function(a){l(a[0]),k(a[1])}),a.isDefined(j.dateChange)&&(m=e.findFunction(f,j.dateChange)),j.onSetDate="dateChange";var r=document.createElement("div");r.innerHTML=d.get("templates/daterange-holder.html"),r.querySelector("[date-range-holder-start]").innerHTML=g(j,o[0],"start",!1,f.end),r.querySelector("[date-range-holder-end]").innerHTML=g(j,o[1],"end",f.start,!1);var s=c(r)(f);i.append(s)}}}]);var d="ng-pristine",e="ng-dirty",c=a.module("datePicker");c.constant("dateTimeConfig",{template:function(a,b){return"<div "+(b?'id="'+b+'" ':"")+'date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.maxDate?'max-date="'+a.maxDate+'" ':"")+(a.autoClose?'auto-close="'+a.autoClose+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.minDate?'min-date="'+a.minDate+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+(a.step?'step="'+a.step+'" ':"")+(a.onSetDate?'date-change="'+a.onSetDate+'" ':"")+(a.ngModel?'ng-model="'+a.ngModel+'" ':"")+(a.timezone?'timezone="'+a.timezone+'" ':"")+(a.watchDirectChanges?'watch-direct-changes="'+a.watchDirectChanges+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),c.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),c.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(c,f,g,h,i,j){var k=f.find("body"),l=g("mFormat");return{require:"ngModel",scope:!0,link:function(f,g,m,n){function o(a){return l(a,x,L)}function p(a){return a.length===x.length?a:void 0}function q(a){H=a,m.minDate=a?a.format():a,I=b.isMoment(a)}function r(a){J=a,m.maxDate=a?a.format():a,K=b.isMoment(a)}function s(){w=h.template(m)}function t(a){a.stopPropagation(),n.$pristine&&(n.$dirty=!0,n.$pristine=!1,g.removeClass(d).addClass(e),y&&y.$setDirty(),n.$render())}function u(){D&&(D.remove(),D=null),G&&(G.remove(),G=null)}function v(){if(!D){if(D=c(w)(f),f.$digest(),O||(f.$on("setDate",function(a,b,c){t(a),N&&N(m.ngModel,b),C&&z[z.length-1]===c&&u()}),f.$on("hidePicker",function(){setTimeout(function(){g[0].blur()},0)}),f.$on("$destroy",u),O=!0),"absolute"===F){var b=a.extend(g.offset(),{height:g[0].offsetHeight});D.css({top:b.top+b.height,left:b.left,display:"block",position:F}),k.append(D)}else G=a.element('<div class="datepicker-holder" date-picker-wrapper></div>'),g[0].parentElement.insertBefore(G[0],g[0]),G.append(D),D.css({top:g[0].offsetHeight+"px",display:"block"});D.bind("mousedown",function(a){a.preventDefault()})}}var w,x=m.format||h.format,y=g.inheritedData("$formController"),z=i(m.views)(f)||h.views.concat(),A=m.view||z[0],B=z.indexOf(A),C=m.autoClose?i(m.autoClose)(f):h.autoClose,D=null,E=g[0].id,F=m.position||h.position,G=null,H=null,I=null,J=null,K=null,L=m.timezone||!1,M=j.eventIsForPicker,N=null,O=!1;-1===B&&z.splice(B,1),z.unshift(A),n.$formatters.push(o),n.$parsers.unshift(p),a.isDefined(m.minDate)&&(q(j.findParam(f,m.minDate)),n.$validators.min=function(a){return I?b.isMoment(a)&&(H.isSame(a)||H.isBefore(a)):!0}),a.isDefined(m.maxDate)&&(r(j.findParam(f,m.maxDate)),n.$validators.max=function(a){return K?b.isMoment(a)&&(J.isSame(a)||J.isAfter(a)):!0}),a.isDefined(m.dateChange)&&(N=j.findFunction(f,m.dateChange)),E&&f.$on("pickerUpdate",function(b,c,d){if(M(c,E))if(D);else{var e=!1;a.isDefined(d.minDate)&&(q(d.minDate),e=!0),a.isDefined(d.maxDate)&&(r(d.maxDate),e=!0),a.isDefined(d.minView)&&(m.minView=d.minView),a.isDefined(d.maxView)&&(m.maxView=d.maxView),m.view=d.view||m.view,e&&n.$validate(),a.isDefined(d.format)&&(x=m.format=d.format||h.format,n.$modelValue=-1),s()}}),g.bind("focus",v),g.bind("blur",u),s()}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div ng-switch="view">\n  <div ng-switch-when="date">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      <tr>\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\n        <td ng-repeat="day in week">\n          <span\n            ng-class="classes[$index2][$index]"\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="year">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(10)">&lsaquo;</th>\n        <th colspan="5" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\n        <th ng-click="next(10)">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-class="classes[$index]"\n                ng-repeat="year in years"\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="month">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="month in months"\n                ng-class="classes[$index]"\n                ng-click="selectDate(month)"\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="hours">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev(24)">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\n        <th ng-click="next(24)">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="hour in hours"\n                ng-class="classes[$index]"\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div ng-switch-when="minutes">\n    <table>\n      <thead>\n      <tr>\n        <th ng-click="prev()">&lsaquo;</th>\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\n        <th ng-click="next()">&rsaquo;</i></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr>\n        <td colspan="7">\n          <span ng-repeat="minute in minutes"\n                ng-class="classes[$index]"\n                ng-click="selectDate(minute)"\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>'),a.put("templates/daterange-holder.html",'<div date-range-holder-start=""></div>\n<div date-range-holder-end=""></div>\n')}])});